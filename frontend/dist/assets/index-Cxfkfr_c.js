(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const n of a.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function t(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(o){if(o.ep)return;o.ep=!0;const a=t(o);fetch(o.href,a)}})();class R{constructor(){this.targets=new Map,this.currentTargetId=null,this.currentIndex=0,this.buffer="",this.listeners={onLock:[],onProgress:[],onMistake:[],onComplete:[],onReset:[]}}addTarget(e,t,i=null){t&&this.targets.set(e,{word:t.toLowerCase(),originalWord:t,userData:i})}removeTarget(e){this.currentTargetId===e&&this.resetState(),this.targets.delete(e)}processKey(e){if(!e||e.length!==1)return;const t=e.toLowerCase();if(!/^[a-z]$/.test(t))return;this.buffer+=t;const i=[];for(const[o,a]of this.targets.entries())a.word.startsWith(this.buffer)&&i.push(o);if(i.length===0){this._emit("onMistake",t),this.resetState();return}if(i.length===1){const o=i[0],a=this.targets.get(o);this.currentTargetId=o,this.currentIndex=this.buffer.length,this._emit("onLock",o),this._emit("onProgress",o,this.currentIndex,t),this.currentIndex>=a.word.length&&(this._emit("onComplete",o,a.originalWord),this.removeTarget(o),this.resetState())}else this._emit("onCandidates",i,this.buffer)}backspace(){if(!this.buffer)return;this.buffer=this.buffer.slice(0,-1);const e=[];for(const[t,i]of this.targets.entries())i.word.startsWith(this.buffer)&&e.push(t);if(e.length===1){const t=e[0],i=this.targets.get(t);this.currentTargetId=t,this.currentIndex=this.buffer.length,this._emit("onLock",t),this._emit("onProgress",t,this.currentIndex,null),this.currentIndex>=i.word.length&&(this._emit("onComplete",t,i.originalWord),this.removeTarget(t),this.resetState())}else e.length>1?(this.currentTargetId=null,this.currentIndex=0,this._emit("onCandidates",e,this.buffer)):this.resetState()}resetState(){this.currentTargetId=null,this.currentIndex=0,this.buffer="",this._emit("onReset")}on(e,t){this.listeners[e]&&this.listeners[e].push(t)}_emit(e,...t){this.listeners[e]&&this.listeners[e].forEach(i=>i(...t))}}const d=new R;class j{constructor(){this.listeners=[],this.reset()}reset(){this.score=0,this.streak=0,this.multiplier=1,this.wordsTyped=0,this.charsTyped=0,this.mistakes=0,this.startTime=Date.now(),this.endTime=null,this._notify()}handleWordComplete(e,t="easy"){const i=e.length*10,o=this._getDifficultyMultiplier(t),a=Math.floor(i*o*this.multiplier);return this.score+=a,this.wordsTyped++,this.charsTyped+=e.length,this._increaseStreak(),this._notify(),a}handleMistake(){this.mistakes++,this.streak=0,this.multiplier=1,this._notify()}_increaseStreak(){this.streak++,this.multiplier=1+Math.floor(this.streak/5),this.multiplier>5&&(this.multiplier=5)}_getDifficultyMultiplier(e){switch(e){case"hard":return 2;case"moderate":return 1.5;default:return 1}}getWPM(){const t=((this.endTime||Date.now())-this.startTime)/6e4;return t<=0?0:Math.round(this.charsTyped/5/t)}getAccuracy(){const e=this.charsTyped+this.mistakes;return e===0?100:Math.round(this.charsTyped/e*1e4)/100}getSessionStats(){return{score:this.score,maxStreak:this.streak,wpm:this.getWPM(),accuracy:this.getAccuracy(),wordsTyped:this.wordsTyped,mistakes:this.mistakes,durationSeconds:((Date.now()-this.startTime)/1e3).toFixed(1)}}onUpdate(e){typeof e=="function"&&this.listeners.push(e)}_notify(){const e={score:this.score,streak:this.streak,multiplier:this.multiplier};this.listeners.forEach(t=>t(e))}}const v=new j,E={easy:["cat","dog","sun","map","book","tree","star","ball","fish","bird","ship","rock","milk","cake","light","rain","wind","fire","snow","sand"],moderate:["planet","rocket","asteroid","galaxy","orbit","launch","shield","target","thrust","module","oxygen","comet","signal","impact","vector","system","engine","radar","syntax","cursor"],hard:["gravitational","constellation","telemetry","trajectory","synchronous","nanotechnology","spectroscopy","hypertension","photosynthesis","electromagnetism","cryptography","reciprocity","transcendent","infrastructure","interstellar"]};function $(s=E){const e=["easy","moderate","hard"];for(const t of e){if(!Array.isArray(s[t]))throw new Error(`words.${t} must be an array`);for(const i of s[t])if(typeof i!="string"||!i.trim())throw new Error(`Invalid word in ${t}: "${i}"`)}return!0}try{$(E)}catch(s){console.error(s)}const F=["easy","moderate","hard"],B={moderate:4,hard:7};function H(s){return!s||s.length===0?null:s[Math.floor(Math.random()*s.length)]}function y(s){const e=[...s];for(let t=e.length-1;t>0;t--){const i=Math.floor(Math.random()*(t+1));[e[t],e[i]]=[e[i],e[t]]}return e}class W{constructor(e=null){this.seed=e,this.pools={easy:E.easy?y([...E.easy]):[],moderate:E.moderate?y([...E.moderate]):[],hard:E.hard?y([...E.hard]):[]},this.usedWords={easy:new Set,moderate:new Set,hard:new Set},this.currentIndices={easy:0,moderate:0,hard:0}}getDifficultyFromLevel(e=1){return e>=B.hard?"hard":e>=B.moderate?"moderate":"easy"}getWord(e="easy"){const t=F.includes(e)?e:"easy",i=this.pools[t];if(!i||i.length===0)return console.warn(`No words available for difficulty: ${t}, using fallback`),this.getFallbackWord();let o=i[this.currentIndices[t]];return this.currentIndices[t]=(this.currentIndices[t]+1)%i.length,this.currentIndices[t]===0&&(this.pools[t]=y([...this.pools[t]])),o}getBatch({difficulty:e="easy",count:t=10}={}){const i=F.includes(e)?e:"easy",o=this.pools[i];if(!o||o.length===0)return console.warn(`No words available for difficulty: ${i}, using fallback`),Array(t).fill("word");const a=[],n=new Set;for(let r=0;r<t;r++){let l,h=0;do{const u=Math.floor(Math.random()*o.length);if(l=o[u],h++,h>5)break}while(n.has(l)&&n.size<o.length);n.add(l),a.push(l)}return a}getByLevel(e=1){const t=this.getDifficultyFromLevel(e);return this.getWord(t)}getWaveWords(e=1,t=8){this.getDifficultyFromLevel(e);const i=[],o=Math.max(.3,1-e*.1),a=.4,n=Math.floor(t*o),r=Math.floor(t*a),l=t-n-r;for(let h=0;h<n;h++)i.push(this.getWord("easy"));for(let h=0;h<r;h++)i.push(this.getWord("moderate"));for(let h=0;h<l;h++)i.push(this.getWord("hard"));return y(i)}getFallbackWord(){return H(["word","type","game","play","test"])}resetUsedWords(){this.usedWords={easy:new Set,moderate:new Set,hard:new Set},this.currentIndices={easy:0,moderate:0,hard:0},this.pools.easy=y([...this.pools.easy]),this.pools.moderate=y([...this.pools.moderate]),this.pools.hard=y([...this.pools.hard])}getStats(){return{easy:{count:this.pools.easy.length},moderate:{count:this.pools.moderate.length},hard:{count:this.pools.hard.length},total:this.pools.easy.length+this.pools.moderate.length+this.pools.hard.length}}}const O=new W;class U{constructor(){this.reset()}reset(){this.level=1,this.wordsTyped=0,this.config={baseSpawnInterval:3500,minSpawnInterval:400,baseEnemySpeed:1,speedIncrement:.25,intervalDecrement:80,wordsPerLevel:5}}onWordTyped(){return this.wordsTyped++,this.wordsTyped%this.config.wordsPerLevel===0?(this.level++,console.log(`Level Up! Now Level ${this.level}`),!0):!1}getSpawnInterval(){const e=(this.level-1)*this.config.intervalDecrement,t=this.config.baseSpawnInterval-e;return Math.max(t,this.config.minSpawnInterval)}getEnemySpeed(){return this.config.baseEnemySpeed+(this.level-1)*this.config.speedIncrement}getWordDifficulty(){return this.level<5?"easy":this.level<10?"moderate":"hard"}getStatus(){return{level:this.level,wordsTyped:this.wordsTyped,nextLevelIn:this.config.wordsPerLevel-this.wordsTyped%this.config.wordsPerLevel}}}const f=new U,z="https://backend-zeta-jade.vercel.app/",w=s=>{const e=z.replace(/\/$/,""),t=s.startsWith("/")?s:`/${s}`;return`${e}${t}`};async function x(s){try{const e=await fetch(w("/api/scores"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!e.ok){const t=await e.json();throw new Error(t.error||"Failed to submit score")}return await e.json()}catch(e){throw console.error("Error submitting score:",e),e}}async function L(s=10){try{const e=await fetch(w(`/api/scores/leaderboard?limit=${s}`));if(!e.ok){const i=await e.json();throw new Error(i.error||"Failed to fetch leaderboard")}return(await e.json()).data}catch(e){throw console.error("Error fetching leaderboard:",e),e}}async function C({limit:s=10,offset:e=0}={}){try{const t=await fetch(w(`/api/scores?limit=${s}&offset=${e}`));if(!t.ok){const o=await t.json();throw new Error(o.error||"Failed to fetch scores")}return(await t.json()).data}catch(t){throw console.error("Error fetching scores:",t),t}}async function D(){try{return(await fetch(w("/health"))).ok}catch(s){return console.error("API health check failed:",s),!1}}const V={submitScore:x,getLeaderboard:L,getScores:C,checkHealth:D};async function q(s){return(await fetch(API_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).json()}const Y=Object.freeze(Object.defineProperty({__proto__:null,checkHealth:D,default:V,getLeaderboard:L,getScores:C,saveScore:q,submitScore:x},Symbol.toStringTag,{value:"Module"}));class K{constructor(){this.state="MENU",this.lastSpawnTime=0,this.playerName="Guest",this.handleInput=this.handleInput.bind(this),this.gameLoop=this.gameLoop.bind(this),this.asteroidPool=[],this._setupTypingEvents()}init(e){this.scene=e,console.log("GameEngine initialized"),this.pauseShown=!1,window.addEventListener("keydown",this.handleInput),this.scene.addEventListener("asteroid-destroyed",t=>{if(t.detail&&t.detail.typed&&t.detail.asteroid){const o=t.detail.asteroid.components["asteroid-component"];if(o){const a=o.data.word,n=f.getWordDifficulty();v.handleWordComplete(a,n),f.onWordTyped(),this.scene.emit("sound-explosion")}}}),this.scene.addEventListener("earth-destroyed",()=>{this.stopGame()})}pauseGame(){this.state==="PLAYING"&&(this.state="PAUSED",window.__GAME_PAUSED__=!0,this.scene&&this.scene.emit("game-paused"))}resumeGame(){this.state==="PAUSED"&&(this.state="PLAYING",window.__GAME_PAUSED__=!1,this.scene&&this.scene.emit("game-resumed"),requestAnimationFrame(this.gameLoop))}startGame(e){if(this.state==="PLAYING")return;console.log(`Starting Game for pilot: ${e}`),this.playerName=e||"Guest",this.state="PLAYING",window.__GAME_PAUSED__=!1,v.reset(),f.reset(),d.resetState();const t=document.getElementById("earth");if(t){t.setAttribute("earth","health",100);const o=t.components&&t.components.earth;o&&(o.healthBarBg&&o.healthBarBg.setAttribute("visible","false"),o.healthBar&&o.healthBar.setAttribute("visible","false"),o.healthText&&o.healthText.setAttribute("visible","false"))}const i=document.getElementById("shield");if(i&&i.components&&i.components.shield){const o=i.components.shield;o.destroyed=!1,i.object3D.visible=!0,o.data.strength=o.data.maxStrength;const a=i.getObject3D("mesh");if(a&&a.material&&(a.material.color.setHex(65535),a.material.opacity=.3,a.scale.set(1,1,1)),i.object3D.rotation.set(0,0,0),o.healthBarBg&&o.healthBarBg.setAttribute("visible","true"),o.healthBar&&o.healthBar.setAttribute("visible","true"),o.healthText&&o.healthText.setAttribute("visible","true"),o.updateHealthBar&&o.updateHealthBar(),this.scene&&this.scene.systems&&this.scene.systems.collision)try{this.scene.systems.collision.shieldDestroyed=!1,this.scene.systems.collision.shield=i}catch{}}else{const o=document.createElement("a-entity");if(o.setAttribute("id","shield"),o.setAttribute("shield","radius: 7; strength: 50; maxStrength: 50"),o.setAttribute("position","0 0 0"),this.scene.appendChild(o),this.scene&&this.scene.systems&&this.scene.systems.collision)try{this.scene.systems.collision.shieldDestroyed=!1,this.scene.systems.collision.shield=o}catch{}}this.lastSpawnTime=performance.now(),requestAnimationFrame(this.gameLoop),this.scene.emit("game-start")}async stopGame(){if(this.state==="GAMEOVER")return;if(this.state="GAMEOVER",window.__GAME_PAUSED__=!0,this.scene){this.scene.querySelectorAll("[asteroid-component]").forEach(o=>{try{d.removeTarget(o.id)}catch{}try{o.parentNode&&o.parentNode.removeChild(o)}catch{}});const i=document.querySelector("#spaceship");i&&i.components["projectile-system"]&&typeof i.components["projectile-system"].clearAll=="function"&&i.components["projectile-system"].clearAll()}const e=v.getSessionStats();console.log("Game Over Stats:",e),this.scene.emit("game-over",e);try{await x({player_name:this.playerName,score:e.score,words_typed:e.wordsTyped,accuracy:e.accuracy,game_duration:e.durationSeconds,difficulty:f.getWordDifficulty()}),console.log("Score submitted successfully!")}catch(t){console.error("Failed to submit score:",t)}}cleanupGame(){if(this.state="MENU",window.__GAME_PAUSED__=!1,this.scene){this.scene.querySelectorAll("[asteroid-component]").forEach(a=>{try{d.removeTarget(a.id)}catch{}try{a.parentNode&&a.parentNode.removeChild(a)}catch{}});const t=document.querySelector("#spaceship");t&&t.components["projectile-system"]&&typeof t.components["projectile-system"].clearAll=="function"&&t.components["projectile-system"].clearAll();let i=document.getElementById("shield");if(i&&i.components&&i.components.shield){const a=i.components.shield;a.destroyed=!1,i.object3D.visible=!0,a.data.strength=a.data.maxStrength;const n=i.getObject3D("mesh");n&&n.material&&(n.material.color.setHex(65535),n.material.opacity=.3,n.scale.set(1,1,1)),i.object3D.rotation.set(0,0,0),a.healthBarBg&&a.healthBarBg.setAttribute("visible","true"),a.healthBar&&a.healthBar.setAttribute("visible","true"),a.healthText&&a.healthText.setAttribute("visible","true"),a.updateHealthBar&&a.updateHealthBar()}else i=document.createElement("a-entity"),i.setAttribute("id","shield"),i.setAttribute("shield","radius: 7; strength: 50; maxStrength: 50"),i.setAttribute("position","0 0 0"),this.scene.appendChild(i),setTimeout(()=>{const a=i.components&&i.components.shield;a&&(a.healthBarBg&&a.healthBarBg.setAttribute("visible","true"),a.healthBar&&a.healthBar.setAttribute("visible","true"),a.healthText&&a.healthText.setAttribute("visible","true"))},0);const o=document.getElementById("earth");if(o&&o.components&&o.components.earth){o.setAttribute("earth","health",100);const a=o.components.earth;a.healthBarBg&&a.healthBarBg.setAttribute("visible","false"),a.healthBar&&a.healthBar.setAttribute("visible","false"),a.healthText&&a.healthText.setAttribute("visible","false")}}v.reset(),f.reset(),d.resetState(),console.log("Game cleaned up for menu return")}resetGame(){console.log("Resetting game for play again..."),this.cleanupGame();const e={score:0,multiplier:1};this.scene&&this.scene.emit("game-reset",e),this.startGame(this.playerName)}handleInput(e){if(e.key==="Escape"){if(this.state==="PLAYING"){this.pauseGame();return}else if(this.state==="PAUSED"){this.resumeGame();return}}this.state==="PLAYING"&&(e.key==="Backspace"?(e.preventDefault(),d.backspace()):e.key.length===1&&d.processKey(e.key))}gameLoop(e){if(this.state!=="PLAYING")return;const t=f.getSpawnInterval();e-this.lastSpawnTime>t&&(this.spawnEnemy(),this.lastSpawnTime=e),requestAnimationFrame(this.gameLoop)}spawnEnemy(){const e=f.getWordDifficulty(),t=f.getEnemySpeed(),i=O.getWord(e);if(!i){console.warn("WordGenerator returned no word!");return}const o=`enemy-${Date.now()}`,a=document.createElement("a-entity");a.setAttribute("id",o);const n=Math.random()*24-12,r=Math.random()*8-1;a.setAttribute("position",`${n} ${r} -50`),a.setAttribute("asteroid-component",{word:i,speed:t,damage:10,useModel:!0}),a.parentNode||this.scene.appendChild(a),d.addTarget(o,i,a),this.scene.emit("asteroid-spawned",{asteroid:a})}_setupTypingEvents(){d.on("onCandidates",e=>{if(!Array.isArray(e))return;document.querySelectorAll("[asteroid-component]").forEach(i=>{i&&i.components["asteroid-component"]&&i.components["asteroid-component"].highlight(!1)}),e.forEach(i=>{const o=document.getElementById(i);o&&o.components["asteroid-component"]&&o.components["asteroid-component"].highlight(!0)})}),d.on("onLock",e=>{const t=document.getElementById(e);t&&t.components["asteroid-component"]&&t.components["asteroid-component"].highlight(!0)}),d.on("onReset",()=>{document.querySelectorAll("[asteroid-component]").forEach(t=>{t&&t.components["asteroid-component"]&&t.components["asteroid-component"].highlight(!1)})}),d.on("onMistake",()=>{document.querySelectorAll("[asteroid-component]").forEach(t=>{t&&t.components["asteroid-component"]&&t.components["asteroid-component"].highlight(!1)})}),d.on("onComplete",e=>{const t=document.getElementById(e);if(!t)return;const i=document.querySelector("#spaceship");i&&i.components["projectile-system"]?i.components["projectile-system"].fireAtTarget(t):t.components["asteroid-component"]&&t.components["asteroid-component"].destroy(!0)})}}const k=new K;AFRAME.registerComponent("asteroid-component",{schema:{word:{type:"string",default:"ERROR"},speed:{type:"number",default:2},damage:{type:"number",default:10},size:{type:"number",default:.7},rotationSpeed:{type:"vec3",default:{x:1,y:1,z:1}},useModel:{type:"boolean",default:!1}},init:function(){this.modelEl=document.createElement("a-entity"),this.data.useModel?(this.modelEl.setAttribute("gltf-model","#asteroid-model"),this.modelEl.setAttribute("scale","0.5 0.5 0.5")):(this.modelEl.setAttribute("geometry","primitive: dodecahedron; radius: 0.5"),this.modelEl.setAttribute("material","color: #888; roughness: 1.0; flatShading: true")),this.el.appendChild(this.modelEl),this.textEl=document.createElement("a-text"),this.textEl.setAttribute("value",this.data.word),this.textEl.setAttribute("align","center"),this.textEl.setAttribute("position","0 10 0"),this.textEl.setAttribute("width","10"),this.textEl.setAttribute("side","double"),this.textEl.setAttribute("look-at","[camera]"),this.el.appendChild(this.textEl),this.rotationAxis={x:Math.random()*this.data.rotationSpeed.x,y:Math.random()*this.data.rotationSpeed.y,z:Math.random()*this.data.rotationSpeed.z},this.destroyed=!1},update:function(s){this.destroyed=!1,this.textEl&&(this.textEl.setAttribute("value",this.data.word),this.textEl.setAttribute("color","#ffffff")),this.rotationAxis={x:Math.random()*this.data.rotationSpeed.x,y:Math.random()*this.data.rotationSpeed.y,z:Math.random()*this.data.rotationSpeed.z},this.el.setAttribute("visible",!0)},tick:function(s,e){if(window.__GAME_PAUSED__===!0||!e)return;const t=this.data.speed*e/1e3,o=this.el.object3D.position.clone().length(),a=document.getElementById("shield"),n=document.getElementById("earth"),r=this.el.sceneEl&&this.el.sceneEl.systems&&this.el.sceneEl.systems.collision;if(!(!a||!a.components.shield||a.components.shield.destroyed||r&&r.shieldDestroyed)&&a&&a.components.shield){const c=a.components.shield.data.radius;if(o<=c+this.data.size+t){a.components.shield.takeDamage(this.data.damage),this.destroy(!1);return}}if(n&&n.components.earth){const c=n.components.earth.data.radius;if(o<=c+this.data.size+t){n.components.earth.takeDamage(this.data.damage),this.destroy(!1);return}}this.el.object3D.position.z+=t;const h=this.el.object3D.position,u=h.length();if(h.z>10&&u>15){const c=document.getElementById("shield");!c||!c.components.shield||c.components.shield.destroyed||r&&r.shieldDestroyed;const m=document.getElementById("earth");m&&m.components.earth&&(m.components.earth.takeDamage(this.data.damage),console.log(`Asteroid passed Earth! Earth took ${this.data.damage} damage.`)),this.removeSelf();return}if(this.modelEl&&(this.modelEl.object3D.rotation.x+=this.rotationAxis.x*(e/1e3),this.modelEl.object3D.rotation.y+=this.rotationAxis.y*(e/1e3),this.modelEl.object3D.rotation.z+=this.rotationAxis.z*(e/1e3)),this.el.sceneEl&&this.el.sceneEl.camera){const c=this.el.sceneEl.camera.el;if(c){const m=new THREE.Vector3,p=new THREE.Vector3;this.el.object3D.getWorldPosition(m),c.object3D.getWorldPosition(p);const b=p.distanceTo(m),A=10,I=80;if(this.textEl){const S=Math.max(0,Math.min(1,(b-A)/(I-A))),g=1.5+(6-1.5)*S;this.textEl.object3D.scale.set(g,g,g)}if(this.modelEl){const S=Math.max(0,Math.min(1,(b-20)/(I-20))),g=.45+(.9-.45)*S;if(this.modelEl.object3D.scale.set(g,g,g),this.textEl){const N=g*2.2;this.textEl.object3D.position.set(0,N,0)}}}}},destroy:function(s){if(this.destroyed)return;this.destroyed=!0;const e=this.el.sceneEl;if(e){const t=document.createElement("a-entity"),i=new THREE.Vector3;this.el.object3D.getWorldPosition(i),t.setAttribute("gltf-model","/assets/meteor_explosion/scene.gltf"),t.setAttribute("position",`${i.x} ${i.y} ${i.z}`),t.setAttribute("scale","0.2 0.2 0.2"),t.setAttribute("animation-mixer","clip: *; loop: once; clampWhenFinished: true"),e.appendChild(t);const o=()=>{if(t&&t.parentNode){t.parentNode.removeChild(t);const a=t.getObject3D("mesh");a&&a.traverse(n=>{n.geometry&&n.geometry.dispose(),n.material&&(Array.isArray(n.material)?n.material.forEach(r=>{r.map&&r.map.dispose(),r.dispose()}):(n.material.map&&n.material.map.dispose(),n.material.dispose()))})}};t.addEventListener("animation-finished",o),setTimeout(o,200)}this._disposeResources(),d.removeTarget(this.el.id),this.el.sceneEl&&this.el.sceneEl.emit("asteroid-destroyed",{asteroid:this.el,typed:!!s}),this.el.parentNode&&this.el.parentNode.removeChild(this.el)},removeSelf:function(){this._disposeResources(),d.removeTarget(this.el.id),this.el.sceneEl&&this.el.sceneEl.emit("asteroid-destroyed",{asteroid:this.el,typed:!1}),this.el.parentNode&&this.el.parentNode.removeChild(this.el)},_disposeResources:function(){if(!this.destroyed){if(this.modelEl){const s=this.modelEl.getObject3D("mesh");s&&s.traverse(e=>{e.geometry&&e.geometry.dispose(),e.material&&(Array.isArray(e.material)?e.material.forEach(t=>{t.map&&t.map.dispose(),t.normalMap&&t.normalMap.dispose(),t.emissiveMap&&t.emissiveMap.dispose(),t.dispose()}):(e.material.map&&e.material.map.dispose(),e.material.normalMap&&e.material.normalMap.dispose(),e.material.emissiveMap&&e.material.emissiveMap.dispose(),e.material.dispose()))})}if(this.textEl){const s=this.textEl.getObject3D("mesh");s&&(s.geometry&&s.geometry.dispose(),s.material&&(s.material.map&&s.material.map.dispose(),s.material.dispose()))}}},highlight:function(s){const e=this.textEl;e&&e.setAttribute("color",s?"#ff4444":"#ffffff")}});AFRAME.registerComponent("earth",{schema:{radius:{type:"number",default:2},health:{type:"number",default:100}},init:function(){this.maxHealth=this.data.health,this.mixer=null,this.cloudAnimation=null,this.modelLoaded=!1,this.modelLoadFailed=!1,this.loadModel(),this.setupHealthBar(),this._shieldDestroyed=!1,this.loadTimeout=setTimeout(()=>{!this.modelLoaded&&!this.modelLoadFailed&&(console.warn("Earth model timeout, using fallback sphere"),this.createFallbackSphere())},3e3)},loadModel:function(){const s=document.createElement("a-entity");s.setAttribute("gltf-model","/assets/earth/scene.gltf"),s.setAttribute("scale",`${this.data.radius} ${this.data.radius} ${this.data.radius}`),s.setAttribute("rotation","0 0 0"),s.addEventListener("model-loaded",e=>{console.log("Earth model loaded"),this.onModelLoaded(e),clearTimeout(this.loadTimeout)}),s.addEventListener("model-error",e=>{console.error("Earth model failed to load"),this.modelLoadFailed=!0,clearTimeout(this.loadTimeout),this.createFallbackSphere()}),this.el.appendChild(s),this.modelEl=s},createFallbackSphere:function(){this.modelEl&&this.modelEl.parentNode&&this.modelEl.parentNode.removeChild(this.modelEl);const s=document.createElement("a-entity");s.setAttribute("geometry",{primitive:"sphere",radius:this.data.radius}),s.setAttribute("material",{color:"#2233FF",roughness:.7,metalness:.3}),this.el.appendChild(s),this.fallbackSphere=s,this.earthRotationSpeed=.05,console.log("Using fallback sphere for Earth")},onModelLoaded:function(s){this.modelLoaded=!0;const e=this.modelEl.components["gltf-model"].model;if(e&&e.animations&&e.animations.length>0){this.mixer=new THREE.AnimationMixer(e);const t=e.animations.find(i=>i.name.toLowerCase().includes("spin")||i.name.toLowerCase().includes("rotation")||i.name.toLowerCase().includes("take"))||e.animations[0];if(t){const i=this.mixer.clipAction(t);i.setLoop(THREE.LoopRepeat),i.play(),console.log("Earth animation playing:",t.name)}if(this.cloudAnimation=e.animations.find(i=>i.name.toLowerCase().includes("cloud")),this.cloudAnimation){const i=this.mixer.clipAction(this.cloudAnimation);i.setLoop(THREE.LoopRepeat),i.play(),console.log("Cloud animation playing")}}},setupHealthBar:function(){const s=this.el.sceneEl,e=document.createElement("a-entity");e.setAttribute("geometry",{primitive:"box",width:6,height:.7,depth:.3}),e.setAttribute("material",{color:"#222222",opacity:.85,transparent:!0}),e.setAttribute("health-bar-billboard","target: #earth; offsetY: 7.5"),e.setAttribute("visible","false"),s.appendChild(e),this.healthBarBg=e;const t=document.createElement("a-entity");t.setAttribute("id","earth-health-bar"),t.setAttribute("geometry",{primitive:"box",width:5.8,height:.6,depth:.32}),t.setAttribute("material",{color:"#00FF00",shader:"flat"}),t.setAttribute("health-bar-billboard","target: #earth; offsetY: 7.5"),t.setAttribute("visible","false"),s.appendChild(t),this.healthBar=t;const i=document.createElement("a-entity");i.setAttribute("id","earth-health-text"),i.setAttribute("text",{value:`EARTH: ${this.data.health}%`,align:"center",color:"#FFFFFF",width:20,font:"roboto"}),i.setAttribute("health-bar-billboard","target: #earth; offsetY: 8.3"),i.setAttribute("visible","false"),s.appendChild(i),this.healthText=i,this.wordOffset=this.data.size+1.5},showHealthBar:function(){console.log("Showing Earth health bar"),this.healthBarBg&&this.healthBarBg.setAttribute("visible","true"),this.healthBar&&this.healthBar.setAttribute("visible","true"),this.healthText&&this.healthText.setAttribute("visible","true"),this.updateHealthBar()},tick:function(s,e){if(window.__GAME_PAUSED__===!0)return;const t=e/1e3;this.mixer&&this.mixer.update(t),(this.modelLoaded||this.fallbackSphere)&&this.earthRotationSpeed&&(this.el.object3D.rotation.y+=this.earthRotationSpeed*t)},takeDamage:function(s){this.data.health=Math.max(0,this.data.health-s),this.updateHealthBar(),this.flashDamage(),console.log(`Earth Health: ${this.data.health}/${this.maxHealth}`),this.el.emit("earth-damaged",{health:this.data.health,damage:s,percentage:this.data.health/this.maxHealth*100}),this.data.health<=0&&(console.log("EARTH DESTROYED - GAME OVER!"),this.el.emit("earth-destroyed"))},flashDamage:function(){if(this.modelEl&&this.modelLoaded){const s=this.modelEl.getObject3D("mesh");s&&s.traverse(e=>{if(e.isMesh&&e.material){const t=e.material.emissive?e.material.emissive.clone():new THREE.Color(0),i=e.material.emissiveIntensity||0;e.material.emissive&&(e.material.emissive.setHex(16711680),e.material.emissiveIntensity=1),setTimeout(()=>{e.material&&e.material.emissive&&(e.material.emissive.copy(t),e.material.emissiveIntensity=i)},100)}})}else if(this.fallbackSphere){const s=this.fallbackSphere.getAttribute("material").color;this.fallbackSphere.setAttribute("material","color","#FF0000"),setTimeout(()=>{this.fallbackSphere.setAttribute("material","color",s)},200)}},updateHealthBar:function(){if(!this.healthBar||!this.healthText)return;const s=this.data.health/this.maxHealth,e={x:s,y:1,z:1};this.healthBar.setAttribute("scale",e);const t=(1-s)*-2;this.healthBar.object3D.position.x=t;let i="#00FF00",o="STABLE";s<.2?(i="#FF0000",o="CRITICAL"):s<.4?(i="#FF3300",o="DANGER"):s<.6?(i="#FF6600",o="WARNING"):s<.8&&(i="#FFAA00",o="CAUTION"),this.healthBar.setAttribute("material","color",i);const a=Math.round(this.data.health);this.healthText.setAttribute("text","value",`EARTH: ${a}% [${o}]`),this.healthText.setAttribute("text","color",i)},heal:function(s){this.data.health=Math.min(this.maxHealth,this.data.health+s),this.updateHealthBar(),this.el.emit("earth-healed",{health:this.data.health,amount:s})}});AFRAME.registerComponent("shield",{schema:{radius:{type:"number",default:3.5},strength:{type:"number",default:50},maxStrength:{type:"number",default:50}},init:function(){console.log("Shield component initializing..."),this.destroyed=!1,this.createShieldMesh(),this.createHealthBar(),this.pulseTime=0,this.hitFlash=!1,console.log("Shield initialized successfully")},createShieldMesh:function(){const s=new THREE.IcosahedronGeometry(this.data.radius,2),e=new THREE.MeshBasicMaterial({color:65535,transparent:!0,opacity:.3,wireframe:!0,wireframeLinewidth:2}),t=new THREE.Mesh(s,e);this.el.setObject3D("mesh",t);const i=new THREE.IcosahedronGeometry(this.data.radius*.98,2),o=new THREE.MeshBasicMaterial({color:65535,transparent:!0,opacity:.15,side:THREE.BackSide}),a=new THREE.Mesh(i,o);t.add(a),this.glowMesh=a,console.log("Shield mesh created and visible")},createHealthBar:function(){const s=this.el.sceneEl,e=document.createElement("a-entity");e.setAttribute("geometry",{primitive:"box",width:6,height:.7,depth:.3}),e.setAttribute("material",{color:"#222222",opacity:.85,transparent:!0}),e.setAttribute("health-bar-billboard","target: #shield; offsetY: 8.5"),s.appendChild(e),this.healthBarBg=e;const t=document.createElement("a-entity");t.setAttribute("id","shield-health-bar"),t.setAttribute("geometry",{primitive:"box",width:5.8,height:.6,depth:.32}),t.setAttribute("material",{color:"#00FFFF",shader:"flat"}),t.setAttribute("health-bar-billboard","target: #shield; offsetY: 8.5"),s.appendChild(t),this.healthBar=t;const i=document.createElement("a-entity");i.setAttribute("id","shield-health-text"),i.setAttribute("text",{value:`SHIELD: ${this.data.strength}/${this.data.maxStrength}`,align:"center",color:"#00FFFF",width:20,font:"roboto"}),i.setAttribute("health-bar-billboard","target: #shield; offsetY: 9.2"),s.appendChild(i),this.healthText=i,console.log("Shield health bar created")},tick:function(s,e){const t=e/1e3;this.pulseTime+=t*2;const i=1+Math.sin(this.pulseTime)*.03,o=this.el.getObject3D("mesh");if(o&&o.scale.set(i,i,i),this.el.object3D.rotation.y+=t*.2,this.el.object3D.rotation.x+=t*.1,this.hitFlash){const a=this.el.getObject3D("mesh").material;a&&(a.opacity=Math.max(.3,a.opacity-t*2),a.opacity<=.3&&(this.hitFlash=!1))}},pulse:function(){this.hitFlash=!0;const s=this.el.getObject3D("mesh");s&&s.material&&(s.material.opacity=.8,s.material.color.setHex(16776960),setTimeout(()=>{s&&s.material&&s.material.color.setHex(65535)},150))},takeDamage:function(s){if(this.destroyed)return!0;this.data.strength=Math.max(0,this.data.strength-s),this.pulse(),console.log(`Shield damaged: ${this.data.strength}/${this.data.maxStrength}`),this.updateHealthBar(),this.el.emit("shield-damaged",{strength:this.data.strength,damage:s,percentage:this.data.strength/this.data.maxStrength*100});const e=this.el.getObject3D("mesh");if(e&&e.material){const t=this.data.strength/this.data.maxStrength;e.material.opacity=.2+t*.4,t<.3?e.material.color.setHex(16711680):t<.6?e.material.color.setHex(16755200):e.material.color.setHex(65535)}return this.data.strength<=0?(this.destroy(),!0):!1},updateHealthBar:function(){if(!this.healthBar||!this.healthText)return;const s=this.data.strength/this.data.maxStrength,e={x:s,y:1,z:1};this.healthBar.setAttribute("scale",e);const t=(1-s)*-2;this.healthBar.object3D.position.x=t;let i="#00FFFF";s<.3?i="#FF0000":s<.6&&(i="#FFAA00"),this.healthBar.setAttribute("material","color",i),this.healthText.setAttribute("text","value",`SHIELD: ${this.data.strength}/${this.data.maxStrength}`),this.healthText.setAttribute("text","color",i)},destroy:function(){if(this.destroyed)return;this.destroyed=!0,console.log("SHIELD DESTROYED!"),this.el.emit("shield-destroyed");const s=this.el.getObject3D("mesh");s&&(s.visible=!1),this.healthBarBg&&this.healthBarBg.parentNode&&this.healthBarBg.parentNode.removeChild(this.healthBarBg),this.healthBar&&this.healthBar.parentNode&&this.healthBar.parentNode.removeChild(this.healthBar),this.healthText&&this.healthText.parentNode&&this.healthText.parentNode.removeChild(this.healthText),this.createExplosion();const e=document.querySelector("#earth");e&&e.components.earth&&e.components.earth.showHealthBar(),setTimeout(()=>{this.el.parentNode&&this.el.parentNode.removeChild(this.el)},400)},createExplosion:function(){const s=document.createElement("a-entity");s.setAttribute("position","0 0 0"),this.el.sceneEl.appendChild(s);const e=document.createElement("a-entity");e.setAttribute("geometry",{primitive:"sphere",radius:this.data.radius*1.2}),e.setAttribute("material",{color:"#FFFFFF",shader:"flat",transparent:!0,opacity:.9}),e.setAttribute("animation",{property:"scale",from:"0.6 0.6 0.6",to:"2 2 2",dur:180,easing:"easeOutQuad"}),e.setAttribute("animation__opacity",{property:"components.material.material.opacity",from:.9,to:0,dur:180,easing:"linear"}),s.appendChild(e);const t=document.createElement("a-entity");t.setAttribute("geometry",{primitive:"ring",radiusInner:this.data.radius*.9,radiusOuter:this.data.radius}),t.setAttribute("material",{color:"#00FFFF",shader:"flat",transparent:!0,opacity:.7}),t.setAttribute("rotation","-90 0 0"),t.setAttribute("animation",{property:"scale",from:"1 1 1",to:"2.2 2.2 2.2",dur:380,easing:"easeOutQuad"}),t.setAttribute("animation__opacity",{property:"components.material.material.opacity",from:.7,to:0,dur:380,easing:"linear"}),s.appendChild(t);const i=18;for(let o=0;o<i;o++){const a=document.createElement("a-entity"),n=.08+Math.random()*.18;a.setAttribute("geometry",{primitive:"sphere",radius:n});const r=Math.random();let l="#FFFFFF";r<.33?l="#00FFFF":r<.66&&(l="#AAFFFF"),a.setAttribute("material",{color:l,shader:"flat",transparent:!0,opacity:1});const h=Math.PI*2*o/i+(Math.random()-.5)*.5,u=(Math.random()-.5)*(Math.PI*.6),c=1.6+Math.random()*1.4,m=Math.cos(h)*Math.cos(u)*this.data.radius,p=Math.sin(u)*this.data.radius,b=Math.sin(h)*Math.cos(u)*this.data.radius;a.setAttribute("position",`${m} ${p} ${b}`);const A=350+Math.random()*200;a.setAttribute("animation",{property:"position",to:`${m*c} ${p*c} ${b*c}`,dur:A,easing:"easeOutQuad"}),a.setAttribute("animation__opacity",{property:"components.material.material.opacity",from:1,to:0,dur:A,easing:"easeInQuad"}),s.appendChild(a)}setTimeout(()=>{s&&s.parentNode&&s.parentNode.removeChild(s)},450)}});AFRAME.registerComponent("health-bar-billboard",{schema:{target:{type:"selector",default:null},offsetY:{type:"number",default:2.5}},init:function(){this.camera=null,this.target=null,this.data.target&&(this.target=this.data.target)},tick:function(){if(!this.camera&&(this.camera=document.querySelector("[camera]"),!this.camera))return;if(this.target){const e=new THREE.Vector3;this.target.object3D.getWorldPosition(e),this.el.object3D.position.set(0,e.y+this.data.offsetY,0)}const s=new THREE.Vector3;this.camera.object3D.getWorldPosition(s),this.el.object3D.lookAt(s)}});AFRAME.registerComponent("spaceship",{schema:{speed:{type:"number",default:50}},init:function(){console.log("ðŸš€ Spaceship initializing..."),this.modelLoaded=!1,this.modelLoadFailed=!1,this.loadModel(),this.loadTimeout=setTimeout(()=>{!this.modelLoaded&&!this.modelLoadFailed&&(console.warn("âš ï¸ Spaceship model timeout, using simple mesh"),this.createFallbackShip())},3e3),console.log("âœ… Spaceship initialized at:",this.el.object3D.position)},tick:function(s,e){const t=Math.min(e/1e3,.1);this.mixer&&this.mixer.update(t)},loadModel:function(){const s=document.createElement("a-entity");s.setAttribute("gltf-model","/assets/spaceship/scene.gltf"),s.setAttribute("scale","0.05 0.05 0.05"),s.addEventListener("model-loaded",e=>{console.log("Spaceship model loaded"),this.modelLoaded=!0,this.onModelLoaded(e),clearTimeout(this.loadTimeout)}),s.addEventListener("model-error",()=>{console.error("Spaceship model failed"),this.modelLoadFailed=!0,clearTimeout(this.loadTimeout),this.createFallbackShip()}),this.el.appendChild(s),this.modelEl=s},onModelLoaded:function(s){const e=this.modelEl.components["gltf-model"].model;if(e&&e.animations&&e.animations.length>0){this.mixer=new THREE.AnimationMixer(e);const t=e.animations.find(i=>i.name.includes("Take 001")||i.name.toLowerCase().includes("take"))||e.animations[0];t&&(this.engineAction=this.mixer.clipAction(t),this.engineAction.setLoop(THREE.LoopRepeat),this.engineAction.play(),console.log("âœ… Engine animation playing:",t.name))}else console.warn("âš ï¸ No animations found in model")},createFallbackShip:function(){this.modelEl&&this.modelEl.parentNode&&(this.modelEl.parentNode.removeChild(this.modelEl),this.modelEl=null);const s=new THREE.Group,e=new THREE.ConeGeometry(.5,2,4),t=new THREE.MeshStandardMaterial({color:43775,emissive:26367,emissiveIntensity:.5,metalness:.8,roughness:.2}),i=new THREE.Mesh(e,t);i.rotation.x=Math.PI,s.add(i),this.el.setObject3D("mesh",s),console.log("ðŸš€ Using fallback spaceship")}});AFRAME.registerComponent("typing-display",{schema:{},init:function(){this.currentInput="",this.targetWord="",this.createHUD(),this.setupKeyboardListeners()},createHUD:function(){const s=document.createElement("div");s.id="typing-hud",s.style.cssText=`
      position: fixed;
      bottom: 80px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1000;
      pointer-events: auto;
      text-align: center;
      display: none;
    `;const e=document.createElement("div");e.id="target-word",e.style.cssText=`
      font-family: 'Orbitron', monospace;
      font-size: 18px;
      color: #888888;
      margin-bottom: 10px;
      letter-spacing: 2px;
    `,s.appendChild(e),this.targetDisplay=e;const t=document.createElement("div");t.style.cssText=`
      background: rgba(0, 0, 0, 0.85);
      border: 2px solid #00FFFF;
      border-radius: 10px;
      padding: 15px 36px;
      min-width: 320px;
      box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
      position: relative;
    `;const i=document.createElement("div");i.id="current-input",i.style.cssText=`
      font-family: 'Orbitron', monospace;
      font-size: 32px;
      color: #00FF00;
      font-weight: bold;
      letter-spacing: 4px;
      min-height: 40px;
      text-shadow: 0 0 10px currentColor;
      pointer-events: none;
    `,i.textContent="_",t.appendChild(i),this.inputText=i;const o=document.createElement("input");o.type="text",o.id="typing-input",o.autocomplete="off",o.autocapitalize="off",o.autocorrect="off",o.spellcheck=!1,o.style.cssText=`
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      opacity: 0;
      border: none;
      background: transparent;
      caret-color: transparent;
      pointer-events: auto;
    `,o.addEventListener("keydown",n=>{if(n.key==="Backspace"){n.preventDefault(),n.stopPropagation(),d.backspace();return}n.key.length===1&&(n.preventDefault(),n.stopPropagation(),d.processKey(n.key))}),t.addEventListener("click",()=>{o.focus()}),t.appendChild(o),this.hiddenInput=o,s.appendChild(t);const a=document.createElement("div");a.id="typing-instruction",a.style.cssText=`
      font-family: 'Orbitron', monospace;
      font-size: 14px;
      color: #00FFFF;
      margin-top: 10px;
      letter-spacing: 1px;
    `,a.textContent="Tap the HUD and type to destroy asteroids!",s.appendChild(a),this.instruction=a,document.body.appendChild(s),this.hudContainer=s,this.el.sceneEl.addEventListener("game-start",()=>{this.show();try{this.hiddenInput.focus()}catch{}}),this.el.sceneEl.addEventListener("game-over",()=>{this.hide();try{this.hiddenInput.blur()}catch{}}),this.el.sceneEl.addEventListener("game-paused",()=>{this.hide()}),this.el.sceneEl.addEventListener("game-resumed",()=>{this.show();try{this.hiddenInput.focus()}catch{}})},setupKeyboardListeners:function(){d.on("onLock",s=>{const e=d.targets.get(s),t=e?e.originalWord:"";this.setTargetWord(t),this.currentInput=e?e.word.substring(0,1):"",this.updateDisplay();try{this.hiddenInput&&this.hiddenInput.focus()}catch{}}),d.on("onProgress",(s,e,t)=>{const i=d.targets.get(s);i&&(this.targetWord=i.originalWord,this.currentInput=i.word.substring(0,e)),this.updateDisplay()}),d.on("onMistake",s=>{this.inputText&&(this.inputText.style.color,this.inputText.style.color="#FF0000",setTimeout(()=>{this.updateDisplay()},220))}),d.on("onComplete",(s,e)=>{this.inputText?(this.inputText.style.color="#FFFFFF",setTimeout(()=>{this.clearInput()},220)):this.clearInput()}),d.on("onReset",()=>{this.clearInput()}),d.on("onCandidates",(s,e)=>{this.targetWord="",this.currentInput=e||"",this.updateDisplay()})},show:function(){this.hudContainer&&(this.hudContainer.style.display="block")},hide:function(){this.hudContainer&&(this.hudContainer.style.display="none")},updateDisplay:function(){if(this.inputText){const s=Date.now()%800<400?"_":"",e=this.currentInput||"",t=e?e+s:"_";if(this.inputText.textContent=t,this.targetWord&&this.currentInput){const i=this.targetWord.toLowerCase().startsWith(this.currentInput);this.inputText.style.color=i?"#00FF00":"#FF0000"}else this.inputText.style.color="#00FF00"}},setTargetWord:function(s){this.targetWord=s,this.targetDisplay&&(this.targetDisplay.textContent=s?`Target: ${s.toUpperCase()}`:"")},clearInput:function(){this.currentInput="",this.targetWord="",this.updateDisplay(),this.targetDisplay&&(this.targetDisplay.textContent="")},hideInstructions:function(){this.instruction&&(this.instruction.style.display="none")},showInstructions:function(){this.instruction&&(this.instruction.style.display="block")},remove:function(){this.hudContainer&&this.hudContainer.parentNode&&this.hudContainer.parentNode.removeChild(this.hudContainer)}});AFRAME.registerComponent("starfield",{schema:{count:{type:"int",default:600},spread:{type:"number",default:120},speed:{type:"number",default:5e-4},twinkle:{type:"number",default:.03}},init(){this.stars=[];const{count:s,spread:e}=this.data;for(let t=0;t<s;t++){const i=document.createElement("a-entity"),o=Math.random()*.06+.01,a=(Math.random()-.5)*e,n=(Math.random()-.5)*e*.5,r=(Math.random()-.5)*e;i.setAttribute("geometry",`primitive: sphere; radius: ${o}`),i.setAttribute("material",`color: #ffffff; shader: flat; opacity: ${.6+Math.random()*.4}; transparent: true`),i.setAttribute("position",`${a} ${n} ${r}`),i.classList.add("starfield-star");const l=Math.random()*3,h=1+Math.random()*2;i.setAttribute("animation__twinkle",`property: material.opacity; from: 0.3; to: ${.8+Math.random()*.2}; dir: alternate; dur: ${1e3*h}; loop: true; delay: ${Math.floor(l*1e3)}`),this.el.appendChild(i),this.stars.push(i)}},tick(s,e){1+this.data.speed*e,this.el.object3D.rotation.y+=this.data.speed*(e*.02)},remove(){this.stars.forEach(s=>{s.parentNode&&s.parentNode.removeChild(s)}),this.stars=[]}});AFRAME.registerComponent("confetti",{schema:{count:{type:"int",default:40},spread:{type:"number",default:6},size:{type:"number",default:.08},duration:{type:"number",default:1200}},init(){this.el.sceneEl.addEventListener("game-over",s=>{setTimeout(()=>this.launch(s.detail||{}),40)})},launch(){const{count:s,spread:e,size:t,duration:i}=this.data,o=this.el.sceneEl;let a=new THREE.Vector3(0,4,8);try{o.camera&&o.camera.el&&a.copy(o.camera.el.object3D.getWorldPosition(new THREE.Vector3))}catch{}const n=["#FF7A7A","#FFD36B","#8AF27E","#5AD8FF","#B08CFF","#FF6EC7"];for(let r=0;r<s;r++){const l=document.createElement("a-entity"),h=t*(.6+Math.random()*1.2),u=n[Math.floor(Math.random()*n.length)];l.setAttribute("geometry",`primitive: sphere; radius: ${h}`),l.setAttribute("material",`color: ${u}; shader: flat; transparent: true; opacity: 1`);const c=new THREE.Vector3((Math.random()-.5)*e,Math.random()*e*.6,-(1+Math.random()*2)),m=a.clone().add(c);l.object3D.position.copy(m);const p=m.clone().add(new THREE.Vector3((Math.random()-.5)*e*2,-(1+Math.random()*4),-(2+Math.random()*6)));l.setAttribute("animation__move",`property: position; to: ${p.x} ${p.y} ${p.z}; dur: ${i}; easing: cubic-bezier(.17,.67,.32,1);`),l.setAttribute("animation__rot",`property: rotation; to: ${Math.random()*360} ${Math.random()*360} ${Math.random()*360}; dur: ${i}; easing: linear;`),l.setAttribute("animation__fade",`property: material.opacity; to: 0; dur: ${i}; easing: linear;`),o.appendChild(l),setTimeout(()=>{l&&l.parentNode&&l.parentNode.removeChild(l)},i+200)}}});AFRAME.registerComponent("projectile-system",{init:function(){this.projectiles=[],this.el&&this.el.sceneEl&&(this.el.sceneEl.addEventListener("game-over",()=>{this.clearAll()}),this.el.sceneEl.addEventListener("game-paused",()=>{}),this.el.sceneEl.addEventListener("game-resumed",()=>{}))},fireAtTarget:function(s){const t=this.el.object3D.position.clone(),i=s.object3D.position.clone(),o=document.createElement("a-entity");o.setAttribute("geometry",{primitive:"cylinder",radius:.15,height:2}),o.setAttribute("material",{color:"#00ff00",emissive:"#00ff00",emissiveIntensity:1.5,shader:"flat"});const a=document.createElement("a-entity");a.setAttribute("geometry",{primitive:"cylinder",radius:.3,height:3}),a.setAttribute("material",{color:"#00ff00",emissive:"#00ff00",emissiveIntensity:.5,transparent:!0,opacity:.4,shader:"flat"}),o.appendChild(a),o.object3D.position.copy(t);const n=new THREE.Vector3;n.subVectors(i,t).normalize();const r=new THREE.Quaternion;r.setFromUnitVectors(new THREE.Vector3(0,1,0),n),o.object3D.quaternion.copy(r),this.el.sceneEl.appendChild(o),this.projectiles.push({el:o,direction:n,speed:60,target:s,hitRadius:2.5,createdAt:Date.now(),maxLifetime:5e3}),console.log("Projectile fired with trail!")},tick:function(s,e){if(window.__GAME_PAUSED__===!0)return;const t=e/1e3;for(let i=this.projectiles.length-1;i>=0;i--){const o=this.projectiles[i],a=o.direction.clone().multiplyScalar(o.speed*t);if(o.el.object3D.position.add(a),o.target&&o.target.components["asteroid-component"]&&!o.target.components["asteroid-component"].destroyed){const n=o.el.object3D.position,r=o.target.object3D.position;if(n.distanceTo(r)<o.hitRadius){console.log("Projectile HIT asteroid!"),o.target.components["asteroid-component"].destroy(!0),o.el.parentNode.removeChild(o.el),this.projectiles.splice(i,1);continue}}Date.now()-o.createdAt>o.maxLifetime&&(o.el.parentNode.removeChild(o.el),this.projectiles.splice(i,1))}},clearAll:function(){for(let s=this.projectiles.length-1;s>=0;s--){const e=this.projectiles[s];try{e.el&&e.el.parentNode&&e.el.parentNode.removeChild(e.el)}catch{}this.projectiles.splice(s,1)}}});AFRAME.registerSystem("collision",{init:function(){this.asteroids=[],this.earth=null,this.shield=null,this.shieldDestroyed=!1,this.checkInterval=16,this.lastCheck=0,this.setupListeners()},setupListeners:function(){this.el.addEventListener("asteroid-spawned",s=>{s.detail&&s.detail.asteroid&&this.asteroids.push(s.detail.asteroid)}),this.el.addEventListener("asteroid-destroyed",s=>{if(s.detail&&s.detail.asteroid){const e=this.asteroids.indexOf(s.detail.asteroid);e>-1&&this.asteroids.splice(e,1)}}),this.el.addEventListener("shield-destroyed",()=>{console.log("Shield destroyed - Earth is now vulnerable!"),this.shieldDestroyed=!0,this.shield=null})},tick:function(s,e){if(!(s-this.lastCheck<this.checkInterval)){if(this.lastCheck=s,!this.earth){const t=document.querySelector("#earth");t&&t.components.earth&&(this.earth=t,console.log("ðŸŒ Earth reference acquired"))}if(!this.shield&&!this.shieldDestroyed){const t=document.querySelector("#shield");t&&t.components.shield&&(this.shield=t,console.log("Shield reference acquired"))}this.asteroids=this.asteroids.filter(t=>t.parentNode&&t.components["asteroid-component"]&&!t.components["asteroid-component"].destroyed),this.asteroids.forEach(t=>{this.checkAsteroidCollisions(t)})}},checkAsteroidCollisions:function(s){if(!s.components["asteroid-component"]||s.components["asteroid-component"].destroyed)return;const e=s.object3D.position,t=s.components["asteroid-component"].data.size,i=e.length();if(this.shield&&this.shield.components.shield&&!this.shieldDestroyed){const o=this.shield.components.shield.data.radius;if(i<=o+t){this.handleShieldCollision(s);return}}if(this.earth&&this.earth.components.earth){const o=this.earth.components.earth.data.radius;if(i<=o+t){this.handleEarthCollision(s);return}}},handleShieldCollision:function(s){console.log("Shield collision!");const e=10;this.shield&&this.shield.components.shield&&this.shield.components.shield.takeDamage(e)&&(console.log("Shield destroyed! Earth is now vulnerable!"),this.shieldDestroyed=!0,this.shield=null),s.components["asteroid-component"]&&s.components["asteroid-component"].destroy(!1),this.el.emit("collision-asteroid-shield",{asteroid:s,damage:e})},handleEarthCollision:function(s){console.log("EARTH COLLISION!");const e=15;this.earth&&this.earth.components.earth&&this.earth.components.earth.takeDamage(e),s.components["asteroid-component"]&&s.components["asteroid-component"].destroy(!1),this.el.emit("collision-asteroid-earth",{asteroid:s,damage:e})}});AFRAME.registerSystem("game-state",{init:function(){this.currentInput="",this.targetAsteroid=null,this.isGameActive=!1,this.setupKeyboardListeners(),this.setupGameListeners()},setupGameListeners:function(){this.el.addEventListener("game-start",()=>{this.isGameActive=!0,this.clearInput()}),this.el.addEventListener("game-over",()=>{this.isGameActive=!1,this.clearInput()}),this.el.addEventListener("game-paused",()=>{this.isGameActive=!1}),this.el.addEventListener("game-resumed",()=>{this.isGameActive=!0})},setupKeyboardListeners:function(){if(window.__USE_TYPING_ENGINE__===!0){console.info("GameStateSystem: TypingEngine active, keyboard listeners disabled");return}document.addEventListener("keydown",s=>{window.__USE_TYPING_ENGINE__!==!0&&(s.target.tagName==="INPUT"||s.target.tagName==="TEXTAREA"||this.isGameActive&&(s.key.length===1&&/^[a-zA-Z]$/.test(s.key)?(s.preventDefault(),this.handleCharacter(s.key.toLowerCase())):s.key==="Backspace"?(s.preventDefault(),this.handleBackspace()):s.key==="Enter"?(s.preventDefault(),this.handleEnter()):s.key==="Escape"&&(s.preventDefault(),this.clearInput())))})},handleCharacter:function(s){var t;this.currentInput+=s;const e=this.findMatchingAsteroid();if(e){this.targetAsteroid&&this.targetAsteroid!==e&&this.targetAsteroid.components["asteroid-component"]&&this.targetAsteroid.components["asteroid-component"].highlight(!1),this.targetAsteroid=e,this.targetAsteroid.components["asteroid-component"]&&this.targetAsteroid.components["asteroid-component"].highlight(!0),this.updateTypingDisplay();const i=(t=this.targetAsteroid.components["asteroid-component"])==null?void 0:t.data.word;this.currentInput===i.toLowerCase()&&this.completeWord()}else this.clearInput(),console.log("No matching asteroid")},handleBackspace:function(){if(this.currentInput.length>0)if(this.currentInput=this.currentInput.slice(0,-1),this.currentInput.length===0)this.clearInput();else{const s=this.findMatchingAsteroid();s?(this.targetAsteroid&&this.targetAsteroid!==s&&this.targetAsteroid.components["asteroid-component"]&&this.targetAsteroid.components["asteroid-component"].highlight(!1),this.targetAsteroid=s,this.targetAsteroid.components["asteroid-component"]&&this.targetAsteroid.components["asteroid-component"].highlight(!0),this.updateTypingDisplay()):this.clearInput()}},handleEnter:function(){var s;if(this.targetAsteroid&&this.currentInput){const e=(s=this.targetAsteroid.components["asteroid-component"])==null?void 0:s.data.word;this.currentInput===e.toLowerCase()?this.completeWord():console.log("Word not complete yet")}},findMatchingAsteroid:function(){if(!this.currentInput)return null;const s=document.querySelectorAll("[asteroid-component]");for(const e of s){if(!e.components["asteroid-component"])continue;const t=e.components["asteroid-component"].data.word;if(t&&t.toLowerCase().startsWith(this.currentInput))return e}return null},completeWord:function(){var t;if(!this.targetAsteroid)return;console.log("Word completed:",this.currentInput);const s=(t=this.targetAsteroid.components["asteroid-component"])==null?void 0:t.data.word;this.el.emit("word-completed",{word:s,asteroid:this.targetAsteroid});const e=document.querySelector("#spaceship");e&&e.components["projectile-system"]&&e.components["projectile-system"].fireAtTarget(this.targetAsteroid),this.clearInput()},updateTypingDisplay:function(){var e;const s=document.querySelector("[typing-display]");if(s&&s.components["typing-display"]){const t=s.components["typing-display"];if(t.currentInput=this.currentInput,this.targetAsteroid){const i=(e=this.targetAsteroid.components["asteroid-component"])==null?void 0:e.data.word;t.setTargetWord(i)}t.updateDisplay()}},clearInput:function(){this.currentInput="",this.targetAsteroid&&(this.targetAsteroid.components["asteroid-component"]&&this.targetAsteroid.components["asteroid-component"].highlight(!1),this.targetAsteroid=null);const s=document.querySelector("[typing-display]");s&&s.components["typing-display"]&&s.components["typing-display"].clearInput()}});const Q="modulepreload",X=function(s){return"/"+s},_={},J=function(e,t,i){let o=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const n=document.querySelector("meta[property=csp-nonce]"),r=(n==null?void 0:n.nonce)||(n==null?void 0:n.getAttribute("nonce"));o=Promise.allSettled(t.map(l=>{if(l=X(l),l in _)return;_[l]=!0;const h=l.endsWith(".css"),u=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${u}`))return;const c=document.createElement("link");if(c.rel=h?"stylesheet":Q,h||(c.as="script"),c.crossOrigin="",c.href=l,r&&c.setAttribute("nonce",r),document.head.appendChild(c),h)return new Promise((m,p)=>{c.addEventListener("load",m),c.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${l}`)))})}))}function a(n){const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=n,window.dispatchEvent(r),!r.defaultPrevented)throw n}return o.then(n=>{for(const r of n||[])r.status==="rejected"&&a(r.reason);return e().catch(a)})},Z="/assets/audio/menu-space.wav",ee="/assets/sounds/new-age-space-144112.mp3",te="/assets/audio/game-over.wav",se="/assets/audio/laser.wav",ie="/assets/audio/explosion.wav",oe="/assets/audio/mistake.wav";class ae{constructor(){this.musicEnabled=!0,this.sfxEnabled=!0,this.scene=null,this.musicAudio=null,this.gameMusicAudio=null,this.baseSfx={},this._unlocked=!1}init(e){this.scene=e,this.musicEnabled=this._loadBool("musicEnabled",!0),this.sfxEnabled=this._loadBool("sfxEnabled",!0),this.musicAudio=new Audio(Z),this.musicAudio.loop=!0,this.musicAudio.volume=.32,this.gameMusicAudio=new Audio(ee),this.gameMusicAudio.loop=!0,this.gameMusicAudio.volume=.32,this.baseSfx={laser:new Audio(se),explosion:new Audio(ie),gameover:new Audio(te),mistake:new Audio(oe)},this._bindUnlock(),this._attachSceneListeners()}_attachSceneListeners(){this.scene&&(this.scene.addEventListener("sound-explosion",()=>this.playSfx("explosion",.75)),this.scene.addEventListener("sound-mistake",()=>this.playSfx("mistake",.6)),this.scene.addEventListener("sound-laser",()=>this.playSfx("laser",.7,1.2)),this.scene.addEventListener("game-start",()=>{this.stopMenuMusic(),this.playGameMusic()}),this.scene.addEventListener("game-over",()=>{this.stopGameMusic(),this.playSfx("gameover",.8),setTimeout(()=>this.playMenuMusic(),900)}))}_bindUnlock(){const e=()=>{var t,i;this._unlocked||(this._unlocked=!0,this.musicEnabled&&((t=this.musicAudio)==null||t.play().catch(o=>console.warn("Music unlock failed",o)),(i=this.gameMusicAudio)==null||i.play().catch(o=>console.warn("Game music unlock failed",o)),this.gameMusicAudio&&(this.gameMusicAudio.pause(),this.gameMusicAudio.currentTime=0)),document.removeEventListener("pointerdown",e),document.removeEventListener("keydown",e))};document.addEventListener("pointerdown",e),document.addEventListener("keydown",e)}_loadBool(e,t){try{const i=localStorage.getItem(`td_sound_${e}`);return i===null?t:i==="true"}catch{return t}}_saveBool(e,t){try{localStorage.setItem(`td_sound_${e}`,t?"true":"false")}catch{}}playMenuMusic(){!this.musicEnabled||!this.musicAudio||(this.stopGameMusic(),this.musicAudio.currentTime=0,this.musicAudio.play().catch(e=>console.warn("Music playback failed",e)))}stopMenuMusic(){this.musicAudio&&this.musicAudio.pause()}playGameMusic(){!this.musicEnabled||!this.gameMusicAudio||(this.stopMenuMusic(),this.gameMusicAudio.currentTime=0,this.gameMusicAudio.play().catch(e=>console.warn("Game music playback failed",e)))}stopGameMusic(){this.gameMusicAudio&&this.gameMusicAudio.pause()}playSfx(e,t=1,i=1){if(!this.sfxEnabled)return;const o=this.baseSfx[e];if(!o)return;const a=o.cloneNode(!0);a.volume=t,a.playbackRate=i,a.play().catch(n=>console.warn(`SFX playback failed (${e})`,n))}setMusicEnabled(e){this.musicEnabled=!!e,this._saveBool("musicEnabled",this.musicEnabled),this.musicEnabled?this.scene&&this.scene.systems&&this.scene.systems["game-state"]&&this.scene.systems["game-state"].state==="PLAYING"?this.playGameMusic():this.playMenuMusic():(this.stopMenuMusic(),this.stopGameMusic())}setSfxEnabled(e){this.sfxEnabled=!!e,this._saveBool("sfxEnabled",this.sfxEnabled)}getSettings(){return{musicEnabled:this.musicEnabled,sfxEnabled:this.sfxEnabled}}}const T=new ae,ne={renderLeaderboard(s,e=[]){if(!s)return;if(s.innerHTML="",!e||e.length===0){s.innerHTML='<p class="muted">No scores yet. Be the first!</p>';return}const t=document.createElement("ol");t.className="leaderboard",e.forEach((i,o)=>{const a=document.createElement("li");a.className="leaderboard-item";const n=`rank-${Math.min(o+1,3)}`;a.classList.add(n),a.style.animationDelay=`${o*70}ms`;const r=document.createElement("div");r.className="leader-left";const l=document.createElement("span");l.className="rank-badge",l.textContent=o===0?"ðŸ†":`${o+1}`;const h=document.createElement("span");h.className="name",h.textContent=i.player_name||`Player ${o+1}`,r.appendChild(l),r.appendChild(h);const u=document.createElement("div");u.className="score",u.textContent=i.score!=null?i.score:"0",a.appendChild(r),a.appendChild(u),t.appendChild(a)}),s.appendChild(t),s.classList.add("leaderboard-revealed"),setTimeout(()=>s.classList.remove("leaderboard-revealed"),Math.min(e.length*70+600,3e3))}},re=3e3,M={STATES:{MENU:"MENU",PLAYING:"PLAYING",PAUSED:"PAUSED",GAMEOVER:"GAMEOVER"},_messageEl:null,_ensureElement(){if(!this._messageEl){if(this._messageEl=document.getElementById("game-message"),!this._messageEl)return null;this._messageEl.style.pointerEvents="auto",this._messageEl.style.padding="10px 16px",this._messageEl.style.borderRadius="8px",this._messageEl.style.background="rgba(0,0,0,0.6)",this._messageEl.style.color="#dffaff",this._messageEl.style.fontFamily="'Orbitron', monospace",this._messageEl.style.fontSize="16px",this._messageEl.style.boxShadow="0 8px 22px rgba(0, 0, 0, 0.6)",this._messageEl.style.transition="opacity 200ms ease",this._messageEl.style.opacity="0"}return this._messageEl},showTemporary(s,e=re){const t=this._ensureElement();t&&(t.textContent=s,t.classList.remove("hidden"),requestAnimationFrame(()=>t.style.opacity="1"),this._hideTimer&&clearTimeout(this._hideTimer),this._hideTimer=setTimeout(()=>this.hide(),e))},showPersistent(s){const e=this._ensureElement();e&&(this._hideTimer&&clearTimeout(this._hideTimer),e.textContent=s,e.classList.remove("hidden"),requestAnimationFrame(()=>e.style.opacity="1"))},hide(){const s=this._ensureElement();s&&(s.style.opacity="0",setTimeout(()=>{s.classList.add("hidden"),s.textContent=""},220))}};class le{constructor(){this.gameEngine=null,this.lastGameStats=null,this.soundManager=null}init(e,t,i){this.gameEngine=e,this.scene=t,this.soundManager=i,this.startBtn=document.getElementById("start-btn"),this.leaderboardBtn=document.getElementById("leaderboard-btn"),this.restartBtn=document.getElementById("restart-btn"),this.menuBtn=document.getElementById("menu-btn"),this.backBtn=document.getElementById("back-btn"),this.submitBtn=document.getElementById("submit-score-btn"),this.menuScreen=document.getElementById("menu-screen"),this.gameoverScreen=document.getElementById("gameover-screen"),this.leaderboardScreen=document.getElementById("leaderboard-screen"),this.scorePanel=document.getElementById("score-panel"),this.pauseScreen=document.getElementById("pause-screen"),this.scoreValue=document.getElementById("score-value"),this.waveValue=document.getElementById("wave-value"),this.comboValue=document.getElementById("combo-value"),this.finalScore=document.getElementById("final-score"),this.finalWave=document.getElementById("final-wave"),this.finalAsteroids=document.getElementById("final-asteroids"),this.finalAccuracy=document.getElementById("final-accuracy"),this.playerNameInput=document.getElementById("player-name-input"),this.leaderboardList=document.getElementById("leaderboard-list"),this.continueBtn=document.getElementById("continue-btn"),this.pauseRestartBtn=document.getElementById("pause-restart-btn"),this.pauseQuitBtn=document.getElementById("pause-quit-btn"),this.musicToggle=document.getElementById("music-toggle"),this.sfxToggle=document.getElementById("sfx-toggle"),this.pauseMusicToggle=document.getElementById("pause-music-toggle"),this.pauseSfxToggle=document.getElementById("pause-sfx-toggle"),this.bindEvents(),this.syncAudioToggles(),v.onUpdate(o=>{this.scoreValue.textContent=o.score,this.comboValue.textContent=`x${o.multiplier}`;try{this.scoreValue&&(this.scoreValue.classList.add("pulse"),setTimeout(()=>this.scoreValue.classList.remove("pulse"),380)),this.comboValue&&(this.comboValue.classList.add("pulse"),setTimeout(()=>this.comboValue.classList.remove("pulse"),380))}catch{}if(this.waveValue)try{this.waveValue.textContent=f.getStatus().level||1}catch{}}),this.scene&&(this.scene.addEventListener("game-start",()=>this.onGameStart()),this.scene.addEventListener("game-reset",o=>this.onGameReset(o.detail||{})),this.scene.addEventListener("game-over",o=>this.onGameOver(o.detail||{})),this.scene.addEventListener("game-paused",()=>this.onGamePaused()),this.scene.addEventListener("game-resumed",()=>this.onGameResumed()))}bindEvents(){var i,o,a,n;this.startBtn&&this.startBtn.addEventListener("click",r=>{var l;this.hideAllScreens(),this.showScorePanel(),(l=this.soundManager)==null||l.stopMenuMusic(),this.gameEngine.startGame()}),this.leaderboardBtn&&this.leaderboardBtn.addEventListener("click",r=>{this.showLeaderboard()}),this.restartBtn&&this.restartBtn.addEventListener("click",r=>{this.hideAllScreens(),this.showScorePanel(),this.gameEngine.resetGame()}),this.menuBtn&&this.menuBtn.addEventListener("click",r=>{this.gameEngine.cleanupGame(),this.hideAllScreens(),this.showMenu()}),this.backBtn&&this.backBtn.addEventListener("click",r=>{this.hideAllScreens(),this.showMenu()}),this.submitBtn&&this.submitBtn.addEventListener("click",async r=>{const l=(this.playerNameInput.value||"Anonymous").trim().slice(0,50);if(this.lastGameStats){this.submitBtn.disabled=!0,this.playerNameInput&&(this.playerNameInput.disabled=!0);try{await x({player_name:l,score:this.lastGameStats.score,words_typed:this.lastGameStats.wordsTyped||0,accuracy:this.lastGameStats.accuracy||0,game_duration:this.lastGameStats.durationSeconds||0}),M.showTemporary("Score submitted!",1800),this.showLeaderboard()}catch(h){console.error("Failed to submit score",h),M.showTemporary("Failed to submit score",1800)}finally{this.playerNameInput&&(this.playerNameInput.disabled=!1),this.submitBtn.disabled=!1}}}),this.playerNameInput&&this.playerNameInput.addEventListener("keydown",r=>{r.key==="Enter"&&(r.preventDefault(),this.submitBtn&&this.submitBtn.click())}),this.continueBtn&&this.continueBtn.addEventListener("click",()=>{this.hidePause(),this.gameEngine.resumeGame()}),this.pauseRestartBtn&&this.pauseRestartBtn.addEventListener("click",()=>{this.hidePause(),this.hideAllScreens(),this.showScorePanel(),this.gameEngine.resetGame()}),this.pauseQuitBtn&&this.pauseQuitBtn.addEventListener("click",()=>{this.hidePause(),this.gameEngine.cleanupGame(),this.hideAllScreens(),this.showMenu()});const e=r=>{var l;(l=this.soundManager)==null||l.setMusicEnabled(r),this.syncAudioToggles()},t=r=>{var l;(l=this.soundManager)==null||l.setSfxEnabled(r),this.syncAudioToggles()};(i=this.musicToggle)==null||i.addEventListener("change",r=>e(r.target.checked)),(o=this.pauseMusicToggle)==null||o.addEventListener("change",r=>e(r.target.checked)),(a=this.sfxToggle)==null||a.addEventListener("change",r=>t(r.target.checked)),(n=this.pauseSfxToggle)==null||n.addEventListener("change",r=>t(r.target.checked))}onGameStart(){var e;(e=this.soundManager)==null||e.stopMenuMusic(),this.hideAllScreens(),this.showScorePanel()}onGameReset(){this.scoreValue.textContent="0",this.waveValue.textContent="1",this.comboValue.textContent="x1",this.hideAllScreens(),this.showScorePanel()}onGameOver(e){this.lastGameStats=e,this.finalScore.textContent=e.score||0,this.finalWave.textContent=e.wave||1,this.finalAsteroids.textContent=e.wordsTyped||0,this.finalAccuracy.textContent=(e.accuracy||0)+"%",this.hideAllScreens(),this.showGameOver();try{this.playerNameInput&&(this.playerNameInput.focus(),typeof this.playerNameInput.select=="function"&&this.playerNameInput.select())}catch{}try{M.showTemporary("Game Over â€” well played!",2500)}catch{}}onGamePaused(){var e,t;(t=(e=this.scorePanel)==null?void 0:e.classList)==null||t.add("hidden"),this.showPause()}onGameResumed(){this.hidePause(),this.showScorePanel()}hideAllScreens(){var e,t,i,o,a,n,r,l,h,u;(t=(e=this.menuScreen)==null?void 0:e.classList)==null||t.add("hidden"),(o=(i=this.gameoverScreen)==null?void 0:i.classList)==null||o.add("hidden"),(n=(a=this.leaderboardScreen)==null?void 0:a.classList)==null||n.add("hidden"),(l=(r=this.scorePanel)==null?void 0:r.classList)==null||l.add("hidden"),(u=(h=this.pauseScreen)==null?void 0:h.classList)==null||u.add("hidden")}showGameOver(){var e,t,i,o;(t=(e=this.gameoverScreen)==null?void 0:e.classList)==null||t.remove("hidden"),(o=(i=this.scorePanel)==null?void 0:i.classList)==null||o.add("hidden")}showScorePanel(){var e,t;(t=(e=this.scorePanel)==null?void 0:e.classList)==null||t.remove("hidden")}showMenu(){var e,t,i,o,a;this.hideAllScreens(),(t=(e=this.menuScreen)==null?void 0:e.classList)==null||t.remove("hidden"),(o=(i=this.scorePanel)==null?void 0:i.classList)==null||o.add("hidden"),this.syncAudioToggles(),(a=this.soundManager)==null||a.playMenuMusic()}async showLeaderboard(e){var t,i,o,a;this.hideAllScreens(),(i=(t=this.leaderboardScreen)==null?void 0:t.classList)==null||i.remove("hidden"),(a=(o=this.scorePanel)==null?void 0:o.classList)==null||a.add("hidden");try{const n=await L(10)||[];this.renderLeaderboard(n),e!==void 0&&this.leaderboardList&&this.leaderboardList.querySelectorAll(".leaderboard-item").forEach(l=>{const h=l.querySelector(".score");h&&parseInt(h.textContent,10)===e&&(l.classList.add("highlight-new"),setTimeout(()=>l.classList.remove("highlight-new"),1600))})}catch(n){console.error("Failed to load leaderboard",n),this.leaderboardList.innerHTML='<p class="muted">Failed to load leaderboard</p>'}}renderLeaderboard(e){ne.renderLeaderboard(this.leaderboardList,e||[])}showPause(){var e,t;this.syncAudioToggles(),(t=(e=this.pauseScreen)==null?void 0:e.classList)==null||t.remove("hidden")}hidePause(){var e,t;(t=(e=this.pauseScreen)==null?void 0:e.classList)==null||t.add("hidden")}syncAudioToggles(){var t,i;const e=((i=(t=this.soundManager)==null?void 0:t.getSettings)==null?void 0:i.call(t))||{musicEnabled:!0,sfxEnabled:!0};[this.musicToggle,this.pauseMusicToggle].forEach(o=>{o&&(o.checked=e.musicEnabled)}),[this.sfxToggle,this.pauseSfxToggle].forEach(o=>{o&&(o.checked=e.sfxEnabled)})}}const he=new le;window.addEventListener("DOMContentLoaded",()=>{const s=document.querySelector("a-scene");if(!s){console.error("A-Frame scene not found");return}k.init(s),T.init(s),window.__USE_TYPING_ENGINE__=!0,he.init(k,s,T),T.playMenuMusic();const e=document.getElementById("starfield");e&&e.setAttribute("starfield","count: 650; spread: 160; speed: 0.0006"),J(()=>Promise.resolve().then(()=>Y),void 0).then(t=>{t.checkHealth().then(i=>{i||console.warn("Backend API seems unreachable. Leaderboard will be offline.")})})});
